<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä–æ–π</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.9"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <div class="w-full max-w-5xl p-8 bg-white shadow-2xl rounded-2xl space-y-10">

    <!-- –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="flex justify-end gap-2 mb-4">
      <a href="index.html"
         class="py-1 px-3 bg-blue-500 text-white text-sm font-medium rounded-lg shadow hover:bg-blue-600 transition">
        New1
      </a>
      <a href="preview.html"
         class="py-1 px-3 bg-green-500 text-white text-sm font-medium rounded-lg shadow hover:bg-green-600 transition">
        Preview
      </a>
    </div>

    <h1 class="text-3xl font-bold text-gray-800 text-center">üì° –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä–æ–π</h1>
    <p class="text-gray-600 text-center">–ó–∞–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ—Ç –±—ç–∫–µ–Ω–¥–∞ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º</p>

    <!-- –ë–ª–æ–∫ 1: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–º–µ—Ä–µ -->
    <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-6 rounded-2xl shadow-lg text-white">
      <h2 class="text-2xl font-semibold mb-4">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–º–µ—Ä–µ</h2>
      <form class="space-y-4">
        <div id="camera-info"
             class="p-4 bg-white/20 rounded-lg text-sm whitespace-pre-wrap">
          –ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–º–µ—Ä–µ...
        </div>
        <button
          type="button"
          class="w-full py-2 px-4 bg-white text-blue-600 font-semibold rounded-xl shadow hover:bg-gray-100 transition"
          onclick="fetchCameraInfo()">
          –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        </button>
      </form>
    </div>

    <!-- –ë–ª–æ–∫ 2: –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
    <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-6 rounded-2xl shadow-lg text-white">
      <h2 class="text-2xl font-semibold mb-4">üìÇ –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤</h2>
      <form class="space-y-4">
        <div id="files-list"
             class="p-4 bg-white/20 rounded-lg text-sm whitespace-pre-wrap">
          –ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤...
        </div>
        <button
          type="button"
          class="w-full py-2 px-4 bg-white text-green-600 font-semibold rounded-xl shadow hover:bg-gray-100 transition"
          onclick="fetchFilesList()">
          –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
        </button>
      </form>
    </div>

  </div>

  <script>
    // --- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –±–∞–∑–æ–≤—ã–π URL –¥–ª—è API –Ω–∞ –ø–æ—Ä—Ç—É 8001
    const API_BASE_8001 = `${window.location.protocol}//${window.location.hostname}:8001`;

    // —Ñ—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è JSON –≤ –∫—Ä–∞—Å–∏–≤—ã–π —Å–ø–∏—Å–æ–∫
    function renderJSON(data) {
      if (typeof data !== "object") return String(data);

      let html = '<ul class="space-y-1">';
      for (const key in data) {
        if (Array.isArray(data[key])) {
          html += `<li><span class="font-semibold">${key}:</span> <ul class="list-disc list-inside ml-4">`;
          data[key].forEach(item => {
            html += `<li>${item}</li>`;
          });
          html += '</ul></li>';
        } else if (typeof data[key] === "object") {
          html += `<li><span class="font-semibold">${key}:</span> ${renderJSON(data[key])}</li>`;
        } else {
          html += `<li><span class="font-semibold">${key}:</span> ${data[key]}</li>`;
        }
      }
      html += "</ul>";
      return html;
    }

    // –∑–∞–ø—Ä–æ—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–º–µ—Ä–µ
    async function fetchCameraInfo() {
      try {
        const url = `${API_BASE_8001}/camera/info`;
        console.log('Fetching:', url);
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
        const data = await response.json();
        document.getElementById('camera-info').innerHTML = renderJSON(data);
      } catch (err) {
        console.error('Camera info error:', err);
        document.getElementById('camera-info').innerHTML = `<span class="text-red-300">–û—à–∏–±–∫–∞: ${err.message}</span>`;
      }
    }

    // –∑–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
    async function fetchFilesList() {
      try {
        const url = `${API_BASE_8001}/files`;
        console.log('Fetching:', url);
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
        const data = await response.json();
        document.getElementById('files-list').innerHTML = renderJSON(data);
      } catch (err) {
        console.error('Files list error:', err);
        document.getElementById('files-list').innerHTML = `<span class="text-red-300">–û—à–∏–±–∫–∞: ${err.message}</span>`;
      }
    }
  </script>

</body>
</html>